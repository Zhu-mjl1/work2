# **DETRs Beat YOLOs on Real-time Object Detection**(CVPR 2024)

## 1. 引言
### 1.1 背景
物体检测是计算机视觉中的基本任务，目标是识别并定位图像中的物体。现代物体检测器主要有两种架构：
- **基于CNN的检测器**：经过多年发展，从初期的两阶段方法演变为当前的一阶段方法。这些研究主要集中在提升检测速度和精度。
- **基于Transformer的检测器（DETRs）**：近年来由于其简化检测流程，特别是消除了NMS等手工设计的组件，受到了广泛关注。然而，DETRs的高计算成本限制了它们在实时应用中的使用。

### 1.2 研究问题
实时物体检测在许多领域中都有重要应用，比如物体跟踪、视频监控、自动驾驶等。现有的实时检测器大多采用CNN架构，但往往依赖于NMS进行后处理，导致推理速度的瓶颈。因此，研究者们开始探索基于Transformer的实时检测器，但其高计算成本仍未得到有效解决。

### 1.3 目标
文章的目标是：
- **提出一个新的实时检测器RT-DETR**，通过重新设计DETR的编码器和解码器，解决其高计算成本的问题。
- **消除NMS带来的延迟**，以便实现真正的端到端实时检测。


## 2. 方法
### 2.1 实时检测Transformer（RT-DETR）架构
RT-DETR的架构包含三部分：
- **骨干网络**：提取输入图像的多尺度特征。
- **高效混合编码器**：用于处理骨干网络输出的多尺度特征，通过解耦尺度内交互和尺度间融合减少计算冗余。
- **解码器与辅助预测头**：通过IoU感知的查询选择机制优化对象查询，并逐层迭代生成边界框和置信度。

### 2.2 高效混合编码器
- **设计思路**：为了减少计算冗余，提出了一种高效混合编码器。编码器分为两部分：
  - **AIFI模块**：基于自注意力的尺度内特征交互，主要在高级特征层（S5）上进行交互，提升特征的全局语义信息。
  - **CCFM模块**：基于卷积的尺度间特征融合，进一步优化了低级特征的融合，减少了冗余计算。
- **效果**：通过这种设计，相较于传统的多尺度Transformer编码器，显著减少了计算开销，同时提升了检测精度。

### 2.3 IoU感知的查询选择
- **问题**：解码器的对象查询初始化对于最终的检测性能至关重要。传统的对象查询初始化往往无法保证高质量的初始查询。
- **解决方案**：引入IoU感知的查询选择机制，在训练过程中引入IoU约束，确保为解码器提供更高质量的初始对象查询，进而提升检测性能。

### 2.4 灵活调整推理速度
- **挑战**：现有的实时检测器需要在不同应用场景下调整推理速度，但通常需要重新训练模型。
- **解决方案**：RT-DETR的设计允许通过调整解码器层数灵活控制推理速度，无需重新训练模型。这使得RT-DETR在多种场景中都具备实际应用价值。


## 3. 实验设计
### 3.1 数据集
实验基于**COCO val2017**数据集进行评估，主要采用了以下指标：
- **平均精度（AP）**：衡量检测器的准确性。
- **每秒帧数（FPS）**：评估检测器的推理速度。

### 3.2 实验平台
测试平台为NVIDIA T4 GPU，模型推理采用FP16精度，并通过TensorRT进行加速。

### 3.3 对比方法
RT-DETR的性能与当前主流的YOLO系列（YOLOv5、YOLOv6、YOLOv7、YOLOv8）以及其他Transformer-based检测器（如Deformable-DETR、DINO）进行了对比。


## 4. 实验结果
### 4.1 RT-DETR在COCO val2017上的表现
- **RT-DETR-L**: 实现了**53.0%**的AP，推理速度达到了**114 FPS**。
- **RT-DETR-X**: 在精度上达到了**54.8%**，推理速度为**74 FPS**。
- **RT-DETR-R50**: 达到了**53.1%**的AP，推理速度为**108 FPS**，相比DINO-Deformable-DETR-R50，精度提高了**2.2%**，推理速度快了约**21倍**（108 FPS vs 5 FPS）。

### 4.2 与YOLO系列的比较
- **YOLO系列模型表现**: YOLOv5、YOLOv7、YOLOv8等模型在速度与精度上仍然存在一定的瓶颈，特别是在需要NMS后处理时，会导致推理速度降低。
- **RT-DETR的优势**: RT-DETR通过取消NMS后处理，提升了推理速度，并在精度上超越了同规模的YOLO检测器，成为新的实时物体检测领域的SOTA。


## 5. 相关工作
### 5.1 实时物体检测器
YOLO系列是实时物体检测的代表，但大多数YOLO检测器都依赖NMS进行冗余边界框的过滤。这会导致推理速度和精度的下降，特别是在处理小目标时，NMS的超参数调优非常困难。

### 5.2 端到端物体检测器
基于Transformer的端到端物体检测器（如DETR）消除了锚点和NMS组件，简化了检测流程。然而，这类模型在训练收敛速度和查询优化上面临挑战。RT-DETR通过引入高效编码器和IoU感知查询选择，解决了这些问题。

### 5.3 多尺度特征
多尺度特征在小物体检测中尤为重要。现代检测器广泛采用多尺度特征融合（如FPN），但这会增加计算开销。RT-DETR通过高效混合编码器优化了多尺度特征的处理，减少了这种冗余。


## 6. 结论
### 6.1 主要贡献
1. **提出首个实时端到端物体检测Transformer（RT-DETR）**，通过消除NMS，达到了速度和精度的全面提升，超越了YOLO系列和其他现有的端到端检测器。
2. **灵活调整推理速度**：通过改变解码器层数，RT-DETR能够适应不同的实时应用场景，极大地提升了实际使用的灵活性。
3. **分析并解决NMS问题**：通过取消NMS后处理，RT-DETR能够维持稳定的推理速度，避免了后处理阶段的延迟。

